<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Ready: Sets, Dictionaries - Make Python Faster: a Practical Guide to Accelerating your Code</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> üìñ Introduction and ToC</a></li><li class="chapter-item "><a href="../when_to_optimise.html"><strong aria-hidden="true">2.</strong> ‚ùì When to Optimise</a></li><li class="chapter-item "><a href="../profiling.html"><strong aria-hidden="true">3.</strong> üîé Profiling</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../profiling/the_simplest_method.html"><strong aria-hidden="true">3.1.</strong> time.time() + print</a></li><li class="chapter-item "><a href="../profiling/unix_time_command.html"><strong aria-hidden="true">3.2.</strong> The Unix time Command</a></li><li class="chapter-item "><a href="../profiling/the_timeit_module.html"><strong aria-hidden="true">3.3.</strong> The timeit Module</a></li><li class="chapter-item "><a href="../profiling/function_calls_with_cprofile.html"><strong aria-hidden="true">3.4.</strong> Splitting Function Calls with cProfile</a></li><li class="chapter-item "><a href="../profiling/adding_decorator_function.html"><strong aria-hidden="true">3.5.</strong> Adding a Decorator Function</a></li><li class="chapter-item "><a href="../profiling/getting_granular_with_line_profiler.html"><strong aria-hidden="true">3.6.</strong> Getting Granular with line-profiler</a></li><li class="chapter-item "><a href="../profiling/profiling_memory_usage.html"><strong aria-hidden="true">3.7.</strong> Profiling Memory Usage</a></li><li class="chapter-item "><a href="../profiling/profiling_on_the_fly.html"><strong aria-hidden="true">3.8.</strong> Profiling on the Fly with Py-Spy</a></li></ol></li><li class="chapter-item expanded "><a href="../data_structures_and_algorithms.html"><strong aria-hidden="true">4.</strong> üèõÔ∏è Data Structures and Algorithms</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../data_structures_and_algorithms/arrays_lists_vs_tuples.html"><strong aria-hidden="true">4.1.</strong> Arrays (Lists vs Tuples)</a></li><li class="chapter-item expanded "><a href="../data_structures_and_algorithms/sets_and_dictionaries.html" class="active"><strong aria-hidden="true">4.2.</strong> Ready: Sets, Dictionaries</a></li><li class="chapter-item "><a href="../data_structures_and_algorithms/generator_comprehension_iteration_and_evaluation.html"><strong aria-hidden="true">4.3.</strong> Let's Get Generating</a></li><li class="chapter-item "><a href="../data_structures_and_algorithms/sensible_loop_design.html"><strong aria-hidden="true">4.4.</strong> Sensible Loop Design</a></li><li class="chapter-item "><a href="../data_structures_and_algorithms/numpy_the_solution_to_lists.html"><strong aria-hidden="true">4.5.</strong> Numpy: the Solution to Lists</a></li><li class="chapter-item "><a href="../data_structures_and_algorithms/accelerating_pandas_with_cpus_and_gpus.html"><strong aria-hidden="true">4.6.</strong> Accelerating Pandas with CPUs and GPUs</a></li><li class="chapter-item "><a href="../data_structures_and_algorithms/dask_and_polars.html"><strong aria-hidden="true">4.7.</strong> Dask and Polars</a></li></ol></li><li class="chapter-item "><a href="../compiling_python.html"><strong aria-hidden="true">5.</strong> ‚öôÔ∏è Compiling Python</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Make Python Faster: a Practical Guide to Accelerating your Code</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ready-sets-dictionaries"><a class="header" href="#ready-sets-dictionaries">Ready: Sets, Dictionaries</a></h1>
<p>The order of elements was important in <code>lists</code> and <code>tuples</code>, but what if we don't care about that? As long as every element is unique (or at least the keys are), we can use another two native data structures in Python: <code>sets</code> and <code>dictionaries</code>. The relationship between them can be summarised as follows:</p>
<div class="table-wrapper"><table><thead><tr><th></th><th>Sets</th><th>Dictionaries</th></tr></thead><tbody>
<tr><td><strong>Keys</strong></td><td>‚úÖ</td><td>‚úÖ</td></tr>
<tr><td><strong>Values</strong></td><td>‚ùå</td><td>‚úÖ</td></tr>
</tbody></table>
</div>
<p>I.e. a <code>set</code> is a data structure containing unique elements; a <code>dictionary</code> is a data structure containing unique elements (it's keys), each of which have some associated data (their values).</p>
<p>Let's summarise the pros and cons of <code>sets</code>/<code>dictionaries</code> vs <code>lists/tuples</code>, on average time complexities for operations and needs:</p>
<div class="table-wrapper"><table><thead><tr><th></th><th>Sets/Dictionaries</th><th>Lists/Tuples</th><th>Who Wins?</th></tr></thead><tbody>
<tr><td><strong>Search</strong></td><td>O(1)</td><td>O(n)</td><td>Sets/Dictionaries</td></tr>
<tr><td><strong>Membership (x in y)</strong></td><td>O(1)</td><td>O(n)</td><td>Sets/Dictionaries</td></tr>
<tr><td><strong>Insertion</strong></td><td>O(1)</td><td>O(1)</td><td>Lists/Tuples (just)</td></tr>
<tr><td><strong>Iteration</strong></td><td>O(n)</td><td>O(n)</td><td>Lists/Tuples (just)</td></tr>
<tr><td><strong>Sorting</strong></td><td>N/A</td><td>O(n log n)</td><td>Lists/Tuples (obvs)</td></tr>
<tr><td><strong>Deletion</strong></td><td>O(1)</td><td>O(n)</td><td>Sets/Dictionaries</td></tr>
<tr><td><strong>Memory</strong></td><td>More (Hashing)</td><td>Less</td><td>Lists/Tuples</td></tr>
</tbody></table>
</div>
<p>Why do sets/dictionaries use more memory? In simple terms, creating one requires an allocation of a block of memory. A hash function then enables the key to be used as an index, allowing for O(1) look-up - just as <code>list[index]</code> is O(1) too. Python does some further optimising under the hood by putting the keys/values into their own array. But still, hash tables are bigger because by nature they contain empty buckets. Also, when a hash table becomes more than 2/3rds full, there's a compute cost of expanding the table (to <code>3 * len(set)</code>).</p>
<p>One other thing to note is that the O(1)s in the Sets/Dictionaries column can also disguise a potential constant factor - how quick the hashing algorithm is. But in general, sets and dictionaries outperform if you're just wanting to add, check, and delete unique elements from groups. Try running the code below to see what I mean!</p>
<pre><code class="language-python">import time

# Create our list and set
unique_list = list(range(100000))
unique_set = set(unique_list)

# Let's iterate through the list and perform membership tests
start_time = time.time()
for i in unique_list:
    _ = i in unique_list
list_time = time.time() - start_time
print("List lookup time:", list_time)

# Compare this with the set
start_time = time.time()
for i in unique_set:
    _ = i in unique_set
set_time = time.time() - start_time
print("Set lookup time:", set_time)
</code></pre>
<p>Here were my results üò≤</p>
<pre><code class="language-shell">List lookup time: 49.48573088645935
Set lookup time: 0.010624885559082031
</code></pre>
<h2 id="a-note-about-imports-and-namespace-dictionary-look-ups"><a class="header" href="#a-note-about-imports-and-namespace-dictionary-look-ups">A Note about Imports and Namespace Dictionary Look-Ups</a></h2>
<p>It's obvious to avoid unneccesary <code>import</code> statements in your script. It's also faster to be explicit with your imports, due to how Python finds things from its namespaces.</p>
<p>It does dictionary look-ups to find things in this order: <code>locals() -&gt; globals() -&gt; __builtin__</code> - and stops when it finds what it's looking for.</p>
<p>Hence the results of this code:</p>
<pre><code class="language-python">import random
from random import randint

def func1(n):
    result = 0
    for _ in range(n):
        result += random.randint(1, 100)
    return result

def func2(n):
    result = 0
    for _ in range(n):
        result += randint(1, 100)
    return result

def func3(n, randint=random.randint):
    result = 0
    for _ in range(n):
        result += randint(1, 100)
    return result

# Testing the functions
print(func1(1000000))
print(func2(1000000))
print(func3(1000000))
</code></pre>
<p>Let's use our trusty friend <a href="../profiling/function_calls_with_cprofile.html">cProfile</a>:</p>
<pre><code class="language-python">python -m cProfile test.py
</code></pre>
<p>Here's the bit of the output we're interested in:</p>
<div class="table-wrapper"><table><thead><tr><th>tottime</th><th>function</th></tr></thead><tbody>
<tr><td>0.381</td><td>test.py:4(func1)</td></tr>
<tr><td>0.358</td><td>test.py:10(func2)</td></tr>
<tr><td>0.353</td><td>test.py:16(func3)</td></tr>
</tbody></table>
</div>
<p>Why's this happened? Let's look at the code more closely:</p>
<ul>
<li>In func1, we explicitly ask to look at the <code>random</code> library, so Python has to go all the way to the <strong>builtin</strong> map to find what it needs. That requires the most dictionary look-ups, and takes the longest time.</li>
<li>func2 leverages the <code>from random import randint</code> line so that it can now find the <code>randint</code> function in <code>globals()</code>. But it's still traversing the <code>locals()</code> map and doing a dictionary look-up.</li>
<li>func3 brings <code>randint</code> into the <code>locals()</code> namespace, minimising Python's search. It looks clunky, but if you're writing code where every millisecond counts...</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../data_structures_and_algorithms/arrays_lists_vs_tuples.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../data_structures_and_algorithms/generator_comprehension_iteration_and_evaluation.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../data_structures_and_algorithms/arrays_lists_vs_tuples.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../data_structures_and_algorithms/generator_comprehension_iteration_and_evaluation.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
